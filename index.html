<!doctype html>
<html>
    <head>
        <title>The Studio</title>
        <meta name="description" content="">
        <link rel="stylesheet" href="vendor/css/vendor.css" />
        <link rel="stylesheet" href="dist/formbuilder.css" />
    </head>
    <body>
        <header><span class="logo"></span> <h1>The Studio | <small>cook & serve new, native, cross-platform apps, faster than it takes to make coffee!</small></h1></header>
        <article>
            <div class='fb-main'></div>
        </article>
        <footer>
            <table>
                <tr>
                    <td>
                        <p>  Read about 
                        <a target="_blank" href="https://nuscribes.com/scribes_app/book/40/read/#Studio">The Studio</a>,
                        <a target="_blank" href="https://nuscribes.com/scribes_app/book/40/read/#Historion">The Historion</a> and 
                        <a target="_blank" href="https://nuscribes.com/scribes_app/book/40/read/#Theatre">The Theatre</a>,
                        that are all part of the amazing, disruptive, emerging-future tech called
                        <a target="_blank" href="https://nuscribes.com/scribes_app/book/40/read/?#chapter-500">Project Okot (Project-O)</a> - yet another service to humanity, by the <a target="_blank" href="https://nuchwezi.com">NuChwezi</a>
                        </p>
                    </td>
                    <td>
                        <a target="_blank" href="https://nuchwezi.com">
                            <span class="logo-nuchwezi"></span>
                        </a>
                    </td>
                </tr>
            </table>
        </footer>

        <script src="vendor/js/vendor.js"></script>
        <script src="vendor/js/qrcode.js"></script>
        <script src="vendor/js/jquery.qrcode.js"></script>
        <script src="vendor/js/FileSaver.js"></script>
        <script src="vendor/js/Blob.js"></script>
        <script src="dist/formbuilder.js"></script>

        <script>
            var defaultQRCODE_SIZE = 200;
            var defaultQRCODE_EXPORT_SIZE = 500;
            var defaultEXPORT_SIZE_H = 400;
            var defaultEXPORT_SIZE_W = 1000;

            function make_qrcode(selector,data,size){
                $(selector).empty();
                $(selector).qrcode({
                    render: 'canvas',
                    width: size,
                    height: size,
                    text: data
                });
            }

            $(function(){
                fb = new Formbuilder({
                    selector: '.fb-main',
                    //bootstrapData: existingForm
                });

                fb.on('save', function(payload){
                    console.log(payload);

                    if(window.publish_persona){

                      $('#code').html('<span class="publish-status">Wait as this persona is published...</span>');
                        $.ajax({
                          url: 'https://theatre.nuchwezi.com/api/persona/create/',
                          type: 'POST',
                          data: payload,
                          contentType: "application/json",
                          success: function(data){
                                console.log(data)
                                make_qrcode('#code',data, defaultQRCODE_EXPORT_SIZE);
                          },
                          error: function(){
                              $('#code').html('<span class="publish-failed">Publishing of this persona failed. Ensure that this studio has access to persona publishing facility, such as a theatre. Contact tech[at]nuchwezi[dot]com, for access to a reliable, first-class theatre implementation, or get access to the entire suite of technologies in Project-Okot.</span>');
                          }
                        });

                        window.publish_persona = false;
                    }

                    if(window.download_persona){
                        var appName = JSON.parse(payload).app.name.replace(/\s+/g,"_") || "Persona";
                        var persona_file_name = appName + "-" + (new Date()).toISOString() + ".persona";
                        $('#code').html('<span class="publish-status">Please save the generated Persona file: ' + persona_file_name + '</span>');
                        saveAs(new Blob([payload], { type: "application/json+persona" }), persona_file_name)
                        window.download_persona = false;
                    }
                })
            });
        </script>

    </body>
</html>
